if (self.CavalryLogger) { CavalryLogger.start_js(["hMDr0"]); }

__d("XEventImpressionLoggerAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/events/ajax/{eventid}/impression/",{eventid:{type:"Int",required:!0},acontext:{type:"StringToStringMap",required:!0}})}),null);
__d("EventImpressionLogger",["Arbiter","AsyncRequest","EventActionContext","OnVisible","Scroll","XEventImpressionLoggerAsyncController"],(function(a,b,c,d,e,f){__p&&__p();g.init=function(a,b){"use strict";return new g(a,b)};function g(a,c){"use strict";this.$1=a,this.$3=c,this.$2=!1,this.$4=null,this.initListeners(),this.$5=new(b("OnVisible"))(this.$1,this.$7.bind(this),!0,0)}g.prototype.initListeners=function(){"use strict";var a=this.$3;this.$6=!a.start_signal;a.start_signal&&b("Arbiter").subscribe(a.start_signal,function(a,b){this.$4=b,this.$6=!0,this.$4?this.$7():this.$2||(this.$5.reset(),this.$5.checkBuffer())}.bind(this));a.stop_signal&&b("Arbiter").subscribe(a.stop_signal,function(){this.$4=null,this.$6=!1}.bind(this));a.check_signal&&b("Arbiter").subscribe(a.check_signal,function(a,b){this.$4=b,this.$4?this.$7():this.$2||(this.$5.reset(),this.$5.checkBuffer())}.bind(this))};g.prototype.$7=function(){"use strict";__p&&__p();var a=this.$3;if(!this.$6)return;if(this.$2)return;if(!document.documentElement||!document.documentElement.contains(this.$1))return;var c=this.$4;if(c&&c.rect){var d=this.$1.getBoundingClientRect(),e=c.rect,f=0;b("Scroll").getTop(c)&&(f=b("Scroll").getTop(c));if(e.left&&e.left>d.left)return;if(e.right&&e.right<d.right)return;if(e.top&&e.top>d.top-f)return;if(e.bottom&&e.bottom<d.bottom-f)return}c=b("XEventImpressionLoggerAsyncController").getURIBuilder().setInt("eventid",a.event_id).setStringToStringMap("acontext",b("EventActionContext").toStringMap(a.action_context)).getURI();new(b("AsyncRequest"))(c).setHandler(function(a){this.$2=!a.getError()}.bind(this)).send()};e.exports=g}),null);
__d("XEventsSuggestionRefreshController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/events/permalink/related_event/refresh/",{fetch_num:{type:"Int",defaultValue:1},key:{type:"String"},seed_eid:{type:"Int"},cursor:{type:"Int",defaultValue:0},displayed_events:{type:"IntVector"},acontext:{type:"StringToStringMap",required:!0},filter_data:{type:"StringToStringMap",defaultValue:{}},pager_data:{type:"StringToStringMap"},removed_eid:{type:"Int"},row_id:{type:"String"}})}),null);
__d("EventSuggestionFetcher",["csx","cx","Animation","Arbiter","AsyncRequest","CSS","DOM","XEventsSuggestionRefreshController","$"],(function(a,b,c,d,e,f,g,h){__p&&__p();a={_displayedIDs:{},_eventsCache:{},_replacementRequestCache:{},addDisplayedEvent:function(a){this._displayedIDs[a]=(this._displayedIDs[a]||0)+1},removeDisplayedEvent:function(a){this._displayedIDs[a]--,this._displayedIDs[a]===0&&delete this._displayedIDs[a]},_computeCacheKey:function(a){return JSON.stringify(a.filter_data)+JSON.stringify(a.acontext)},replace:function(a,b,c,d){if(!c)return;var e=this._computeCacheKey(c);if(!this._addReplacementRequest(e,a,b,d))return;this._setFetchData(e,c);this._replaceFromCache(e)},_addReplacementRequest:function(a,b,c,d){this._replacementRequestCache[a]||(this._replacementRequestCache[a]=[]);for(var e=0;e<this._replacementRequestCache[a].length;e++)if(this._replacementRequestCache[a][e].eid===b)return!1;this._replacementRequestCache[a].push({eid:b,row_id:c,callback:d});return!0},_setFetchData:function(a,b){if(this._eventsCache[a])return;this._eventsCache[a]={events:[],fetchdata:{filter_data:b.filter_data,acontext:b.acontext,seed_eid:b.seed_eid,cursor:0},fetching:!1}},_replaceFromCache:function(a){__p&&__p();while(this._replacementRequestCache[a].length>0)if(this._isCacheEmpty(a)){this._fetchEvent(a);return}else{var b=this._popFirstCachedEvent(a),c=this._replacementRequestCache[a].shift();this._replaceItem(c.row_id,b.item,b.divider);this.removeDisplayedEvent(c.eid);c.callback()}},_isCacheEmpty:function(a){return!this._eventsCache[a]||this._eventsCache[a].events.length===0},cacheEvents:function(a,b,c){if(!this._eventsCache[b])return;this._eventsCache[b].fetchdata.curser=c;this._eventsCache[b].fetching=!1;a.forEach(function(a){this._eventsCache[b].events.push({event_id:a.id,item:a.item,divider:a.divider})},this);this._replaceFromCache(b)},_popFirstCachedEvent:function(a){if(!this._eventsCache[a]||this._eventsCache[a].events.length===0)return null;var b=this._eventsCache[a].events.shift();this._eventsCache[a].events.length===0&&delete this._eventsCache[a];return b},_fetchEvent:function(a){if(!this._eventsCache[a]||this._eventsCache[a].fetching)return;this._eventsCache[a].fetching=!0;var c=this._eventsCache[a].fetchdata,d=this._replacementRequestCache[a][0];c=b("XEventsSuggestionRefreshController").getURIBuilder().setInt("fetch_num",6).setString("key",a).setInt("seed_eid",c.seed_eid).setInt("cursor",c.cursor).setIntVector("displayed_events",Object.keys(this._displayedIDs)).setStringToStringMap("filter_data",c.filter_data).setStringToStringMap("acontext",c.acontext).setStringToStringMap("pager_data",{fetch_num:6,key:a}).setInt("removed_eid",d.eid).setString("row_id",d.row_id).getURI();new(b("AsyncRequest"))(c).setErrorHandler(function(){this._eventsCache[a].fetching=!1}.bind(this)).send()},_replaceItem:function(a,c,d){var e=b("$")(a);b("CSS").addClass(e,"fbEventsSuggestionRemovingItem");b("DOM").insertAfter(e,c);d&&b("DOM").insertBefore(e,d);new(b("Animation"))(e).to("opacity",0).duration(500).ondone(function(){b("CSS").hide(e),b("CSS").addClass(c,"fbEventsSuggestionShowingItem"),b("CSS").show(c),b("DOM").remove(e),e=null,new(b("Animation"))(c).from("opacity",0).to("opacity",1).ondone(function(){d&&(b("DOM").remove(d),d=null),c.style.opacity=null,b("CSS").removeClass(c,"fbEventsSuggestionShowingItem"),b("Arbiter").inform("EventSuggestion/insert")}).duration(300).ease(b("Animation").ease.end).show().go()}.bind(this)).ease(b("Animation").ease.end).hide().go()},_removeItem:function(a){a=b("$")(a);b("DOM").remove(a)},_clearEmptyCard:function(a){a=b("$")(a);var c=b("DOM").scry(a,"div.fbEventsSuggestionItem");c.length===0&&(c=b("DOM").scry(a,"li.fbEventsSuggestionItem"));c.length===0&&b("DOM").remove(a)},clearItems:function(a,b){if(!this._eventsCache[a])return;this._eventsCache[a].fetching=!1;while(this._replacementRequestCache[a].length>0){var c=this._replacementRequestCache[a].shift();this._removeItem(c.row_id);this.removeDisplayedEvent(c.eid)}this._clearEmptyCard(b)}};e.exports=a}),null);
__d("XEventsSuggestionHideController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/events/permalink/related_event/update/",{removed_eid:{type:"Int",required:!0},acontext:{type:"StringToStringMap",required:!0},hide_type:{type:"String",required:!0}})}),null);
__d("EventsSuggestionSync",["Arbiter","AsyncRequest","EventSuggestionFetcher","EventSuggestionHideAction","XEventsSuggestionHideController"],(function(a,b,c,d,e,f){__p&&__p();a={init:function(){b("Arbiter").subscribe("EventSuggestions/report",this.reportEvent.bind(this))},setData:function(a,b,c,d){this._data||(this._data={}),this._data[a]={removed_eid:a,row_id:d,filter_data:c,acontext:b}},setListener:function(a,c){b("EventSuggestionFetcher").addDisplayedEvent(c),a.getMenu().subscribe("itemclick",function(a,d){switch(d.item.getValue()){case b("EventSuggestionHideAction").HIDE:this._hideItem(c,b("EventSuggestionHideAction").HIDE);this.replace(c);break}}.bind(this))},reportEvent:function(a,c){this._hideItem(c.eid,b("EventSuggestionHideAction").REPORT),this.replace(c.eid)},_hideItem:function(a,c){if(!this._data||!this._data[a])return;a=b("XEventsSuggestionHideController").getURIBuilder().setInt("removed_eid",this._data[a].removed_eid).setStringToStringMap("acontext",this._data[a].acontext).setString("hide_type",c).getURI();new(b("AsyncRequest"))(a).send()},replace:function(a){if(!this._data||!this._data[a])return;b("EventSuggestionFetcher").replace(a,this._data[a].row_id,this._data[a],function(){this._removeEvent(a)}.bind(this))},_removeEvent:function(a){this._data&&delete this._data[a]}};e.exports=a}),null);
__d("UpdateRelatedEvents",["Arbiter","AsyncRequest","EventSuggestionFetcher","EventSuggestionHideAction","XEventsSuggestionHideController"],(function(a,b,c,d,e,f){__p&&__p();a={init:function(a,c,d){this._seedID=a,this._actionContext=c,this._data={},b("Arbiter").subscribe("EventSuggestions/report",this.reportEvent.bind(this))},setListener:function(a,c,d,e){b("EventSuggestionFetcher").addDisplayedEvent(c),this._data[c]={removed_eid:c,seed_eid:this._seedID,row_id:d,filter_data:e,acontext:this._actionContext},a.getMenu().subscribe("itemclick",function(a,d){switch(d.item.getValue()){case b("EventSuggestionHideAction").HIDE:this._hideItem(c,b("EventSuggestionHideAction").HIDE);this.replace(c);break}}.bind(this))},reportEvent:function(a,c){this._hideItem(c.eid,b("EventSuggestionHideAction").REPORT),this.replace(c.eid)},_hideItem:function(a,c){if(!this._data||!this._data[a])return;a=b("XEventsSuggestionHideController").getURIBuilder().setInt("removed_eid",this._data[a].removed_eid).setStringToStringMap("acontext",this._data[a].acontext).setString("hide_type",c).getURI();new(b("AsyncRequest"))(a).send()},replace:function(a){if(!this._data||!this._data[a])return;b("EventSuggestionFetcher").replace(a,this._data[a].row_id,this._data[a],function(){this._removeEvent(a)}.bind(this))},_removeEvent:function(a){this._data&&delete this._data[a]}};e.exports=a}),null);
__d("EventSuggestionAction",["csx","cx","Animation","CSS","DOM","Event","EventActionSource","EventsSuggestionSync","EventSuggestionHideAction","UpdateRelatedEvents","$"],(function(a,b,c,d,e,f,g,h){__p&&__p();a={_canShowNux:!0,_xoutShowing:!1,_reportDialogs:{eventData:{},dialogs:{}},_nux:{},_items:{},_timers:{},registerReportDialog:function(a,b){a.subscribe(["show"],function(){this._reportDialogs.dialogs[b]={showing:!0},this._stopRefresh(this._reportDialogs.eventData.eid,this._reportDialogs.eventData.source)}.bind(this)),a.subscribe(["hide"],function(){this._reportDialogs.dialogs[b]={showing:!1},this._startRefresh(this._reportDialogs.eventData.eid,this._reportDialogs.eventData.source)}.bind(this))},_isReportDialogShowing:function(){for(var a in this._reportDialogs.dialogs)if(Object.prototype.hasOwnProperty.call(this._reportDialogs.dialogs,a)&&this._reportDialogs.dialogs[a].showing)return!0;return!1},addNux:function(a,b){this._nux[b]=a},registerXOutMenu:function(a,c,d){a.getPopover().subscribe("hide",function(){this._xoutShowing=!1,this._startRefresh(c,d)}.bind(this)),a.getPopover().subscribe("show",function(){this._xoutShowing=!0,this._stopRefresh(c,d)}.bind(this)),a.getMenu().subscribe("itemclick",function(a,e){switch(e.item.getValue()){case b("EventSuggestionHideAction").REPORT:this._reportDialogs.eventData={eid:c,source:d};break}}.bind(this))},addButton:function(a,c,d,e){__p&&__p();this._items[e]||(this._items[e]={},this._timers[e]={}),b("Event").listen(a,"click",function(){__p&&__p();var f=this._items[e][d];f||(f=b("DOM").find(a,"^.fbEventsSuggestionItem"),this._items[e][d]=f);if(c==="watch"||c==="join"||c==="save"||c==="maybe"){b("CSS").addClass(f,"fbEventsSuggestionFadingItem");var g=null;c==="maybe"&&(b("CSS").addClass(f,"fbEventsSuggestionMaybedItem"),g=".fbEventsSuggestionImageMaybeOverlay");c==="join"&&(b("CSS").addClass(f,"fbEventsSuggestionJoinedItem"),g=".fbEventsSuggestionImageJoinedOverlay");c==="watch"&&(b("CSS").addClass(f,"fbEventsSuggestionWatchedItem"),g=".fbEventsSuggestionImageWatchedOverlay");c==="save"&&(b("CSS").addClass(f,"fbEventsSuggestionSavedItem"),g=".fbEventsSuggestionImageSavedOverlay");g&&this.easeInImageOverlay(f,g)}else b("CSS").removeClass(f,"fbEventsSuggestionFadingItem"),this._timers[e][d]&&(clearTimeout(this._timers[e][d]),delete this._timers[e][d]);b("Event").listen(f,"mouseout",function(){this._startRefresh(d,e)}.bind(this));b("Event").listen(f,"mouseover",function(){this._stopRefresh(d,e)}.bind(this))}.bind(this))},_startRefresh:function(a,c){__p&&__p();if(!this._items[c])return;var d=this._items[c][a];if(!d||this._xoutShowing)return;if(this._isReportDialogShowing()&&this._reportDialogs.eventData.eid===a)return;var e=this._nux[c];e=!e||!e.isShown();b("CSS").matchesSelector(d,".fbEventsSuggestionFadingItem")&&e&&(this._timers[c][a]=setTimeout(function(){this.refreshItem(a,c)}.bind(this),3600))},_stopRefresh:function(a,b){this._timers[b]&&this._timers[b][a]&&(clearTimeout(this._timers[b][a]),delete this._timers[b][a])},refreshItem:function(a,c){var d=null;c===b("EventActionSource").EVENT_DASHBOARD_SUGGESTION_UPCOMING||c===b("EventActionSource").EVENT_DASHBOARD_SUGGESTION_PAST||c===b("EventActionSource").EVENT_DASHBOARD_SUGGESTION_BIRTHDAYS||c===b("EventActionSource").EVENT_SUGGESTION?d=b("UpdateRelatedEvents"):c===b("EventActionSource").EVENT_BOTTOM_SUGGESTION||c===b("EventActionSource").DASHBOARD_FRIEND_EVENT||c===b("EventActionSource").DASHBOARD_RELATED_EVENT||c===b("EventActionSource").DASHBOARD_POPULAR_EVENT?d=b("EventsSuggestionSync"):c===b("EventActionSource").DASHBOARD_SUBSCRIBED_CARD&&(this._items[c]&&this._items[c][a]&&(b("DOM").remove(this._items[c][a]),delete this._items[c][a]));if(!d)return;d.replace(a)},easeInImageOverlay:function(a,c){var d=b("DOM").find(a,".fbEventsSuggestionImageOverlay"),e=b("DOM").find(a,c);new(b("Animation"))(d).from("opacity",0).to("opacity",1).duration(200).ondone(function(){b("CSS").show(d),d.style.opacity=null,new(b("Animation"))(e).from("opacity",0).to("opacity",1).duration(200).ondone(function(){b("CSS").show(e),e.style.opacity=null}).ease(b("Animation").ease.end).show().go()}).ease(b("Animation").ease.end).show().go()},swapItem:function(a,c,d){var e=b("$")(a),f=b("$")(c);b("CSS").addClass(e,"fbEventsSuggestionRemovingItem");d&&b("DOM").insertBefore(e,d);new(b("Animation"))(e).to("opacity",0).duration(500).ondone(function(){b("CSS").hide(e),b("CSS").addClass(f,"fbEventsSuggestionShowingItem"),b("CSS").show(f),b("DOM").remove(e),e=null,new(b("Animation"))(f).from("opacity",0).to("opacity",1).ondone(function(){f.style.opacity=null,d&&(b("DOM").remove(d),d=null),b("CSS").removeClass(f,"fbEventsSuggestionShowingItem")}).duration(300).ease(b("Animation").ease.end).show().go()}.bind(this)).ease(b("Animation").ease.end).hide().go()},clearEmptyCard:function(a){a=b("$")(a);var c=b("DOM").scry(a,"div.fbEventsSuggestionItem");c.length===0&&(c=b("DOM").scry(a,"li.fbEventsSuggestionItem"));c.length===0&&b("DOM").remove(a)}};e.exports=a}),null);
__d("EventSuggestionXOutMenuController",[],(function(a,b,c,d,e,f){__p&&__p();function a(a,b){"use strict";this.$1=a,this.$2=b}a.prototype.getMenu=function(){"use strict";return this.$1};a.prototype.getPopover=function(){"use strict";return this.$2.getPopover()};e.exports=a}),null);